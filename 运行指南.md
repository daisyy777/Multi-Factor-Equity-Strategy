# 如何运行回测

## 快速开始（3步）

### 步骤 1: 打开命令行

在 Windows 上：
- 按 `Win + R`，输入 `cmd` 或 `powershell`，按回车
- 或者在项目文件夹中，按住 `Shift` 键，右键点击空白处，选择"在此处打开 PowerShell 窗口"

### 步骤 2: 进入项目目录

```bash
cd D:\QUANT\multi_factor
```

### 步骤 3: 运行回测

```bash
python scripts/run_backtest.py
```

## 完整流程

```bash
# 1. 进入项目目录
cd D:\QUANT\multi_factor

# 2. (首次运行或更新依赖时) 安装依赖
pip install -r requirements.txt

# 3. 运行回测
python scripts/run_backtest.py
```

## 运行时间

- 首次运行：5-15分钟（需要下载数据）
- 后续运行：2-5分钟（使用缓存数据）

## 查看结果

运行完成后，结果保存在：

1. **性能指标**: `results/metrics.json`
   - 最终 NAV
   - 年化收益率
   - Sharpe 比率
   - 最大回撤等

2. **回测数据**: `results/backtest_results.parquet`
   - 每日 NAV
   - 每日收益
   - 持仓价值等

3. **图表**: `reports/figures/`
   - NAV 曲线图
   - 收益分布图等

## 查看结果示例

```bash
# 查看性能指标
python -c "import json; m = json.load(open('results/metrics.json')); print(f'Final NAV: ${m[\"final_nav\"]:,.2f}'); print(f'Total Return: {m[\"total_return\"]*100:.2f}%')"
```

## 常见问题

### 1. 找不到模块 (ModuleNotFoundError)

**解决**：
```bash
pip install -r requirements.txt
```

### 2. 数据下载失败

- 检查网络连接
- 稍后重试
- 如果之前下载过，会使用缓存

### 3. 想要重新开始（清理缓存）

```bash
python scripts/clean_cache.py
```

然后重新运行回测。

## 修改参数（可选）

编辑 `src/utils/config.py` 可以修改：
- 回测日期范围
- 调仓频率
- 初始资金
- 交易成本等
